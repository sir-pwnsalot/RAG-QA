(()=>{var E=Object.defineProperty,T=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var D=(o,c,s)=>c in o?E(o,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[c]=s,l=(o,c)=>{for(var s in c||(c={}))q.call(c,s)&&D(o,s,c[s]);if(O)for(var s of O(c))P.call(c,s)&&D(o,s,c[s]);return o},u=(o,c)=>T(o,N(c));(function(){var I;let o=document.currentScript,c="dub_id",s="dub_partner_data",S=90*24*60*60*1e3,d=window.location.hostname,m=o.getAttribute("data-api-host")||"https://api.dub.co",C=o.getAttribute("data-publishable-key"),w=(()=>{let i={domain:d==="localhost"?void 0:`.${d.replace(/^www\./,"")}`,path:"/",sameSite:"Lax",expires:new Date(Date.now()+S).toUTCString()},n=o.getAttribute("data-cookie-options");if(!n)return i;let t=JSON.parse(n);return t.expiresInDays&&(t.expires=new Date(Date.now()+t.expiresInDays*24*60*60*1e3).toUTCString(),delete t.expiresInDays),l(l({},i),t)})(),h=(()=>{let i=o.getAttribute("data-short-domain"),n=o.getAttribute("data-domains");if(n)try{let t=JSON.parse(n);return u(l({},t),{refer:t.refer||i})}catch(t){}return{refer:i}})(),p=h.refer,y=o.getAttribute("data-attribution-model")||"last-click",b=o.getAttribute("data-query-param")||"via",f=new URLSearchParams(location.search).get(b);if(window.DubAnalytics=window.DubAnalytics||{partner:null,discount:null},window.dubAnalytics){let t=function(r,...e){r==="ready"?t.ready(...e):r==="trackClick"?t.trackClick(...e):console.warn("[dubAnalytics] Unknown method:",r)};var $=t;let n=window.dubAnalytics.q||[];t.q=n,t.ready=function(r){r()},t.trackClick=function(...r){A(...r)},window.dubAnalytics=t}let a={get(i){var n;return(n=document.cookie.split(";").map(t=>t.trim().split("=")).find(([t])=>t===i))==null?void 0:n[1]},set(i,n){let t=Object.entries(w).filter(([,r])=>r).map(([r,e])=>`${r}=${e}`).join("; ");document.cookie=`${i}=${n}; ${t}`}},k={queue:((I=window.dubAnalytics)==null?void 0:I.q)||[],flush(i){let n=[];for(;this.queue.length;){let[t,...r]=this.queue.shift();!i||i(t)?this.process({method:t,args:r}):n.push([t,...r])}this.queue=n},process({method:i,args:n}){if(i==="ready"){let t=n[0];t()}else["trackClick"].includes(i)?A(...n):console.warn("[dubAnalytics] Unknown method:",i)}},g=!1;function A({domain:i,key:n}){if(g)return;g=!0;let r=new URLSearchParams(location.search).get(c);fetch(`${m}/track/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:i,key:n,url:window.location.href,referrer:document.referrer})}).then(e=>e.ok&&e.json()).then(e=>{if(e){if(r&&r!==e.clickId){console.warn(`[dubAnalytics] Client-tracked click ID ${e.clickId} does not match server-tracked click ID ${r}, skipping...`);return}if(a.set(c,e.clickId),e.partner){let R=u(l({},e),{partner:u(l({},e.partner),{name:encodeURIComponent(e.partner.name),image:e.partner.image?encodeURIComponent(e.partner.image):null})});a.set(s,JSON.stringify(R)),DubAnalytics.partner=e.partner,DubAnalytics.discount=e.discount,k.flush(U=>U==="ready")}return e}})}function _(){let i=new URLSearchParams(location.search),n=()=>!a.get(c)||y!=="first-click",t=i.get(c);t&&n()&&a.set(c,t),f&&p&&n()&&A({domain:p,key:f}),k.flush(e=>e==="trackClick");let r=a.get(s);if(r)try{let e=JSON.parse(r);DubAnalytics.partner=e.partner,DubAnalytics.discount=e.discount}catch(e){console.error("[dubAnalytics] Failed to parse partner cookie:",e)}}window._dubAnalytics={c:a,i:c,h:d,a:m,o:w,d:p,m:y,p:b,v:f,n:h,k:C,qm:k},_()})();})();
